# Agent Platform V2 - 交互设计方案

## 📋 设计背景

### 现有问题
- 功能分散,用户需要在多个页面间跳转
- 交互逻辑繁杂且统一,复杂参数配置门槛高
- 专业工具和工作流没有清晰的区分和定位
- 缺少智能引导,普通用户不知道该用哪个功能

### 设计目标
1. **降低认知负担** - 让普通用户无需学习即可使用
2. **清晰的功能分层** - 简单需求对话解决,复杂需求用模板
3. **统一的交互框架** - 外层体验差异化,底层架构统一化
4. **智能路由能力** - AI帮用户找到最合适的工具

---

## 🎯 核心设计理念

### 按使用场景分类,而非按功能分类

**传统思维(功能导向)**:
```
图像生成 | 视频生成 | 音频生成 | 3D建模 | 工作流
```

**新思维(场景导向)**:
```
我要快速做点东西 → Agent模块
我要用专业工具/模板 →Ground
我要找之前做的东西 → Library
```

### 交互复杂度递进

```
Agent模块：零配置(自然语言)
         ↓ 需要更多控制
Ground：显式配置(动态表单)
         ↓ 想要最佳实践
工作流：专家配置封装(一键应用)
```

### 外层差异化,内层统一化

- **外层** - 三个入口,体验差异明显
- **内层** - 底层API统一,配置组件复用

---

## 🏗️ 整体架构

### 导航结构

```
┌────────────────────────────────────┐
│  Logo  [🤖 Agent] [✨Ground] [📁 Library] │
└────────────────────────────────────┘
```

### 页面路由

```
/agent          → Agent对话页(默认首页)
/marketplace    →Ground
/gallery        → 我的作品
/marketplace/tool/:id     → 单个工具使用页
/marketplace/workflow/:id → 单个工作流使用页
```

---

## 🤖 模块1：Agent模块

### 定位
**智能路由器 + 快速生成工具**

### 核心能力
- 对话式快速生成(图像/音频/简单文案)
- 推荐合适的工具和工作流
- 收集复杂需求的参数信息

### 交互设计

#### 页面布局

```
┌──────────────────────────────────────┐
│                                      │
│        对话历史区                      │
│                                      │
│   AI: 你好!我可以帮你...                │
│   - 快速生成图片、音频、文案          │
│   - 推荐适合的专业工具               │
│                                      │
│   你: 帮我做个产品宣传视频            │
│                                      │
│   AI: 这个需求比较复杂,我推荐:       │
│   ┌──────────────────┐              │
│   │ [工具卡片1]      │              │
│   │ 产品展示工具     │              │
│   │ 适合:多角度展示  │              │
│   └──────────────────┘              │
│   ┌──────────────────┐              │
│   │ [工作流卡片1]    │              │
│   │ 宣传视频生成     │              │
│   │ 包含:配音+字幕   │              │
│   └──────────────────┘              │
│                                      │
│   或者,你可以描述更多细节,           │
│   我帮你快速生成草稿版?              │
│                                      │
├──────────────────────────────────────┤
│  输入框                              │
│  "试试说:给我生成一张赛博朋克风格的猫" │
│  [📎] [🎨] [🎬] [🎵]  快捷按钮      │
└──────────────────────────────────────┘
```

#### 交互逻辑

**场景1：简单需求(直接生成)**
```
用户: "生成一张赛博朋克风格的猫"
→ Agent调用图像API
→ 图片直接显示在对话中
→ AI: "满意吗?需要调整颜色或构图吗?"
→ 自动保存到Library
```

**场景2：复杂需求(推荐工具)**
```
用户: "我要做个产品展示视频,配上介绍音频"
→ Agent分析需求复杂度
→ 推荐2-3个相关工具/工作流(卡片形式)
→ 用户选择工具 → 跳转到Ground对应页面
→ 或选择"让AI帮我做" → 继续对话收集参数
```

**场景3：不确定需求(引导探索)**
```
用户: "我想做点营销相关的东西"
→ AI: "好的!是想做海报、视频还是文案呢?"
→ 用户: "视频"
→ AI: "视频的用途是?"
   [社交媒体短视频] [产品介绍] [品牌故事]
→ 根据选择推荐对应工具
```

### 媒体结果处理

**显示规则**:
- 图像: 直接内嵌显示
- 音频: 播放器组件
- 视频: 缩略图 + 播放按钮
- 文本: Markdown渲染

**保存规则**:
- 所有生成的媒体自动保存到Library
- 保存元数据: 
  ```json
  {
    "type": "agent_generation",
    "context": "对话历史",
    "model_used": "gpt-4-vision",
    "prompt": "用户输入"
  }
  ```

### 首页引导文案

```
💬 适合快速生成:
- 单张图片
- 简单配音
- 文案创作

🛠️ 需要精细控制时,试试Ground的专业工具
```

---

## ✨ 模块2：Ground

### 定位
**工具市场 + 工作流中心**

### 核心概念

#### 工具 vs 工作流
- **工具**: 单一功能的专业能力(图像生成器、视频剪辑器、音频合成器)
- **工作流**: 多步骤流程封装(拍照→美化→加字→导出)

**用户心智模型**:
- 工具 = "我知道要做什么,给我专业的控制"
- 工作流 = "我要某个效果,一键帮我完成"

### 交互设计

#### 主页布局(分区展示)

```
┌──────────────────────────────────────┐
│ 🛠️ 专业工具                          │
│ 快速、精准、专业控制                  │
├──────────────────────────────────────┤
│ ┌────────┐ ┌────────┐ ┌────────┐   │
│ │ [图标] │ │ [图标] │ │ [图标] │   │
│ │ 图像   │ │ 视频   │ │ 音频   │   │
│ │ 生成器 │ │ 剪辑器 │ │ 合成器 │   │
│ │        │ │        │ │        │   │
│ │ 🔥 热度 │ │ 🔥 热度 │ │ 🔥 热度 │   │
│ └────────┘ └────────┘ └────────┘   │
│                                      │
│ ⚡ 智能工作流                         │
│ 一键生成专业效果                      │
├──────────────────────────────────────┤
│ ┌────────┐ ┌────────┐ ┌────────┐   │
│ │ [效果] │ │ [效果] │ │ [效果] │   │
│ │ 封面图 │ │ 封面图 │ │ 封面图 │   │
│ ├────────┤ ├────────┤ ├────────┤   │
│ │产品展示│ │宣传视频│ │AI配音  │   │
│ │工作流  │ │工作流  │ │工作流  │   │
│ │⚡多步骤│ │⚡多步骤│ │⚡多步骤│   │
│ └────────┘ └────────┘ └────────┘   │
└──────────────────────────────────────┘
```

**为什么分区?**
- 用户需要明确理解"工具"和"工作流"的差异
- 工具适合有经验用户,工作流适合快速出效果
- 避免混淆,降低选择成本

#### 工具使用页(左右结构)

```
┌──────────────┬──────────────────────┐
│              │                      │
│  参数配置区  │  预览区 + 结果展示   │
│              │                      │
│  必填参数 *  │  [示例效果图]        │
│  ────────────│                      │
│  🖼️ 上传图片 │  「这里会显示你的结果」│
│  [选择文件]  │                      │
│              │                      │
│  📝 提示词   │                      │
│  [输入文本]  │                      │
│              │                      │
│  推荐配置    │  [生成按钮]          │
│  ────────────│                      │
│  🎨 风格     │  [保存到Library]      │
│  [下拉选择]  │                      │
│              │                      │
│  高级选项    │  生成历史            │
│  ────────────│  ────────────────────│
│  🔧 详细参数 │  [缩略图1] [缩略图2] │
│  [折叠]      │                      │
│              │                      │
│  [生成 →]    │                      │
└──────────────┴──────────────────────┘
```

**参数卡片设计原则**:

1. **三层结构**
```
必填参数(总是展开,红色星号)
├─ 上传文件
├─ 输入文本
└─ 基础选择

推荐配置(默认折叠,有默认值)
├─ 风格选择
├─ 质量设置
└─ 尺寸比例

高级选项(默认折叠,专业用户)
├─ 模型版本
├─ 采样步数
└─ CFG参数
```

2. **动态渲染**
```json
// 工具配置JSON示例
{
  "tool_id": "image_generator_v2",
  "params": [
    {
      "name": "prompt",
      "type": "text-input",
      "label": "提示词",
      "required": true,
      "placeholder": "描述你想要的图像"
    },
    {
      "name": "style",
      "type": "dropdown",
      "label": "风格",
      "required": false,
      "level": "recommended",
      "options": ["赛博朋克", "水彩画", "油画"],
      "default": "赛博朋克"
    }
  ]
}
```

3. **组件复用**
```jsx
<ParamCard type="image-upload" />
<ParamCard type="text-input" />
<ParamCard type="dropdown" />
<ParamCard type="slider" />
```

#### 工作流使用页

```
点击工作流卡片后:

┌──────────────────────────────────────┐
│  [返回广场]   产品展示工作流          │
├──────────────────────────────────────┤
│                                      │
│  效果预览                            │
│  [大图展示示例效果]                  │
│                                      │
│  工作流说明                          │
│  该工作流包含3个步骤:                │
│  1. 上传产品图片                     │
│  2. AI自动抠图美化                   │
│  3. 生成3D旋转展示视频               │
│                                      │
├──────────────────────────────────────┤
│  需要配置的参数:                     │
│  ────────────────────────────────────│
│  🖼️ 产品图片 *                       │
│  [上传]                              │
│                                      │
│  🎨 背景风格                         │
│  [简约白] [科技蓝] [渐变紫]          │
│                                      │
│  ⏱️ 视频时长                         │
│  [5秒] [10秒] [15秒]                │
│                                      │
│  [开始生成 →]                        │
└──────────────────────────────────────┘
```

**与工具页的差异**:
- 工作流展示"步骤说明"而非"参数配置"
- 参数更少更简洁(封装了复杂度)
- 有"预计耗时"提示

### 数据结构设计

```typescript
// 统一的"模板"数据结构
interface Template {
  id: string;
  name: string;
  type: 'tool' | 'workflow';
  category: 'image' | 'video' | 'audio' | '3d';
  thumbnail: string;
  description: string;
  heat: number; // 热度值
  
  // 动态配置
  config: {
    params: ParamConfig[];
    api_endpoint: string;
  };
  
  // 工作流专属
  workflow?: {
    steps: string[];
    estimated_time: number;
  };
}
```

---

## 📁 模块3：Library

### 定位
**统一的结果展示 + 快速复用入口**

### 核心能力
- 展示所有来源的生成结果(Agent/工具/工作流)
- 支持"再次编辑"跳转到原始入口
- 分享/下载功能

### 交互设计

#### 页面布局

```
┌──────────────────────────────────────┐
│  [全部] [图片] [视频] [音频] [工作流]  │
├──────────────────────────────────────┤
│                                      │
│  今天                                │
│  ┌──────────┐ ┌──────────┐         │
│  │[缩略图]  │ │[缩略图]  │         │
│  │          │ │          │         │
│  │赛博朋克猫│ │产品视频  │         │
│  │📱 AI对话 │ │🛠️ 工具   │         │
│  │2小时前   │ │1小时前   │         │
│  │          │ │          │         │
│  │[👁️查看]  │ │[👁️查看]  │         │
│  │[🔄再做]  │ │[🔄再做]  │         │
│  │[⬇️下载]  │ │[⬇️下载]  │         │
│  │[🔗分享]  │ │[🔗分享]  │         │
│  └──────────┘ └──────────┘         │
│                                      │
│  昨天                                │
│  ┌──────────┐ ┌──────────┐         │
│  │...       │ │...       │         │
│  └──────────┘ └──────────┘         │
└──────────────────────────────────────┘
```

### 来源标识设计

**三种来源图标**:
- 📱 AI对话 - 来自Agent模块
- 🛠️ 专业工具 - 来自工具页面
- ⚡ 智能工作流 - 来自工作流页面

### "再次编辑"行为

```javascript
function handleReEdit(item) {
  switch(item.source_type) {
    case 'agent':
      // 跳回Agent并恢复对话上下文
      router.push(`/agent?restore=${item.id}`);
      break;
    case 'tool':
      // 跳到工具页面并恢复参数
      router.push(`/marketplace/tool/${item.tool_id}?params=${item.params}`);
      break;
    case 'workflow':
      // 跳到工作流页面
      router.push(`/marketplace/workflow/${item.workflow_id}`);
      break;
  }
}
```

### 数据结构

```typescript
interface GalleryItem {
  id: string;
  user_id: string;
  source_type: 'agent' | 'tool' | 'workflow';
  media_type: 'image' | 'video' | 'audio' | 'text';
  
  // 媒体文件
  file_url: string;
  thumbnail_url: string;
  
  // 元数据
  created_at: string;
  name: string; // 自动生成或用户命名
  
  // 来源信息(用于"再次编辑")
  source_context: {
    tool_id?: string;
    workflow_id?: string;
    conversation_id?: string;
    params?: Record<string, any>;
  };
  
  // 用户操作
  is_favorite: boolean;
}
```

### 自动清理机制

```
规则:
- 30天未收藏的作品 → 自动删除
- 删除前3天发送提醒
- 收藏的作品永久保存
```

---

## 🔄 核心交互流程

### 流程1：新用户首次使用

```
进入网站
    ↓
默认进入 Agent页面
    ↓
看到引导文案: "试试说:给我生成一张..."
    ↓
输入简单需求
    ↓
立即看到结果(建立信心)
    ↓
AI提示: "如需更多控制,试试Ground"
    ↓
好奇点击Ground
    ↓
看到分类清晰的工具和工作流
    ↓
选择一个工具试用
    ↓
在Library看到自己的所有作品
```

### 流程2：复杂需求处理

```
用户在Agent说: "做个产品宣传视频"
    ↓
Agent识别复杂度
    ↓
推荐3个相关模板(卡片)
    ↓
用户点击工作流卡片
    ↓
跳转到工作流详情页
    ↓
看到步骤说明和效果预览
    ↓
填写简单参数
    ↓
点击生成
    ↓
自动保存到Library
    ↓
Library中点击"再做一个"
    ↓
直接回到该工作流页面(参数已填充)
```

### 流程3：Agent → 工具 → Library闭环

```
Agent快速生成图片
    ↓
用户不满意,想精细调整
    ↓
AI: "要不试试图像工具?可以调整细节"
    ↓
[去使用工具]按钮
    ↓
跳转到图像工具,上一次生成的图片已加载
    ↓
调整参数重新生成
    ↓
满意后保存
    ↓
Library显示两个版本(Agent版+工具版)
    ↓
两个版本都标记了来源
```

---

## 💾 数据流设计

### 统一生成记录结构

```typescript
interface GenerationRecord {
  id: string;
  user_id: string;
  
  // 来源分类
  source: {
    type: 'agent' | 'tool' | 'workflow';
    id: string; // tool_id或workflow_id
    entry_point: string; // 从哪个页面触发
  };
  
  // 输入参数
  input: {
    prompt?: string;
    files?: string[];
    params: Record<string, any>;
  };
  
  // 输出结果
  output: {
    media_type: 'image' | 'video' | 'audio' | 'text';
    file_url: string;
    thumbnail_url?: string;
    metadata: Record<string, any>;
  };
  
  // 可恢复上下文
  restorable_context: {
    conversation_history?: Message[];
    tool_state?: Record<string, any>;
  };
  
  created_at: string;
}
```

### API调用链

```
前端请求
    ↓
API网关(/api/generate)
    ↓
识别类型(agent/tool/workflow)
    ↓
调用对应服务
    ↓
获取结果
    ↓
保存到generation_records表
    ↓
异步保存到gallery表
    ↓
返回结果给前端
```

---

## 🚀 实施优先级

### Phase 1: 核心体验(MVP) - 2周

**目标**: 验证三模块架构可行性

- [ ] Agent模块
  - 基础对话界面
  - 接入图像生成API
  - 结果内嵌显示
- [ ]Ground
  - 主页分区布局
  - 3个工具 + 2个工作流
  - 动态配置表单组件
- [ ] Library
  - 基础展示(时间线)
  - 下载功能
  - 来源标识

**成功标准**:
- 用户能完成"Agent生成→工具精修→Library查看"完整流程
- 普通用户无需帮助文档即可使用

### Phase 2: 智能路由 - 1周

**目标**: Agent真正成为"智能助手"

- [ ] Agent推荐工具功能
  - 复杂度判断逻辑
  - 工具卡片推荐
  - 跳转参数传递
- [ ] Library"再次编辑"
  - 恢复上下文
  - 参数回填

**成功标准**:
- Agent能正确识别复杂需求并推荐工具
- 用户能从Library一键回到原始工具

### Phase 3: 体验优化 - 1周

**目标**: 打磨细节,提升留存

- [ ] Agent多轮对话优化
  - 上下文管理
  - 版本管理(如果需要)
- [ ]Ground
  - 搜索功能
  - 标签筛选
  - 热度排序
- [ ] Library
  - 收藏功能
  - 批量操作
  - 分享链接

**成功标准**:
- 7日留存率 > 40%
- 平均会话时长 > 10分钟

---

## ⚠️ 潜在风险与解决方案

### 风险1: Agent能力边界不清晰

**问题**: 用户不知道什么该对话做,什么该去用工具

**解决方案**:
1. 首页引导文案明确说明
2. Agent主动提示能力边界
   ```
   AI: "这个需求比较复杂,对话可以做个基础版,
        但如果想要专业效果,建议使用[产品展示工具]"
   [快速版] [专业版→]
   ```
3. 收集用户行为数据,持续优化推荐逻辑

### 风险2: 工具和工作流概念混淆

**问题**: 普通用户可能不理解"工作流"

**解决方案**:
1. 改名建议:
   - 工具 → "单项能力"
   - 工作流 → "一键方案"或"效果模板"
2. 视觉上明确区分(图标、布局、描述语)
3. Tooltip提示:
   ```
   工具: 灵活控制,适合有经验的用户
   工作流: 一键出效果,新手推荐
   ```

### 风险3: Library快速膨胀

**问题**: 用户频繁使用后,Library变得难以管理

**解决方案**:
1. 自动清理机制(30天未收藏删除)
2. 智能分组:
   - 按项目分组
   - 按时间分组
   - 按类型分组
3. 搜索功能(按名称、标签、来源)
4. 存储优化:
   - 图像压缩
   - 视频低码率版本

### 风险4: Agent推荐不准确

**问题**: Agent推荐的工具/工作流不符合用户预期

**解决方案**:
1. 引入反馈机制
   ```
   推荐后询问: "这个推荐对你有帮助吗?"
   [很有帮助] [不太合适]
   ```
2. 数据驱动优化:
   - 记录推荐→点击转化率
   - 记录推荐→完成率
   - 持续调整推荐逻辑
3. 总是保留"让AI帮我做"选项

---

## 🛠️ 技术实现建议

### 前端组件设计

```typescript
// 1. 动态配置表单组件
<DynamicForm 
  config={toolConfig} 
  onSubmit={handleGenerate}
/>

// 2. 模板卡片组件
<TemplateCard 
  template={item}
  type="tool" // or "workflow"
  onClick={handleCardClick}
/>

// 3. 作品项组件
<GalleryItem
  item={record}
  onReEdit={handleReEdit}
  onShare={handleShare}
/>

// 4. Agent消息组件
<AgentMessage
  message={msg}
  type="text" | "recommendation" | "media"
/>
```

### 路由设计

```typescript
// app/agent/page.tsx
export default function AgentPage() {
  // 处理恢复上下文
  const restoreId = searchParams.get('restore');
  // ...
}

// app/marketplace/tool/[id]/page.tsx
export default function ToolPage({ params }) {
  const toolConfig = await fetchToolConfig(params.id);
  const defaultParams = searchParams.get('params');
  // ...
}
```

### 状态管理

```typescript
// Agent状态
const [conversation, setConversation] = useState<Message[]>([]);
const [isGenerating, setIsGenerating] = useState(false);

// 工具状态
const [params, setParams] = useState<Record<string, any>>({});
const [generationHistory, setHistory] = useState<Result[]>([]);

// 全局状态(Context)
const [user, setUser] = useState<User | null>(null);
const [gallery, setGallery] = useState<GalleryItem[]>([]);
```

### API设计

```typescript
// 统一生成接口
POST /api/generate
Body: {
  source_type: 'agent' | 'tool' | 'workflow',
  source_id: string,
  input: {
    prompt?: string,
    files?: string[],
    params: Record<string, any>
  }
}

// 工具配置获取
GET /api/marketplace/tool/:id/config

// 工作流配置获取
GET /api/marketplace/workflow/:id/config

// Library查询
GET /api/gallery?type=all&page=1&limit=20

// 恢复上下文
GET /api/restore/:record_id
```

---

## 📊 成功指标

### 用户体验指标
- [ ] 首次使用完成率 > 80%
- [ ] 7日留存率 > 40%
- [ ] 平均会话时长 > 10分钟
- [ ] Agent→工具转化率 > 20%

### 功能使用指标
- [ ] Agent使用占比 40-50%
- [ ] 工具使用占比 30-40%
- [ ] 工作流使用占比 20-30%
- [ ] Library回访率 > 30%

### 业务指标
- [ ] 月活用户数 MAU
- [ ] 平均生成次数/用户
- [ ] 付费转化率(如有)

---

## 📝 后续迭代方向

### 短期(1-2个月)
- [ ] Agent能力扩展(接入更多模型)
- [ ] 工具/工作流市场化(UGC)
- [ ] Library社交功能(点赞/评论)

### 中期(3-6个月)
- [ ] 项目协作功能
- [ ] 模板定制化(用户自定义)
- [ ] API开放平台

### 长期(6个月+)
- [ ] 移动端适配
- [ ] 企业版功能
- [ ] 生态建设(第三方集成)
